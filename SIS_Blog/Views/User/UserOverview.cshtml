@{
    ViewData["Title"] = "Users";
}
<div class="container mt-4">
    <div class="row mb-4">
        <div class="col">
            <h2>User Overview</h2>
        </div>
        <div class="col text-end">
            <a href="#" onclick="openRegister()" class="btn btn-primary">Create New User</a>
        </div>
    </div>

    <div class="card">
        <div class="card-body">

            <table id="users-table" class="table table-hover text-light">
                <thead>
                    <tr class="text-light">
                        <th>Username</th>
                        <th>Email</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                </tbody>
            </table>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        (function(){
            const tbody = document.querySelector('#users-table tbody');
            fetch('/api/users', { credentials: 'include' })
                .then(r => r.json())
                .then(users => {
                    tbody.innerHTML = '';
                    users.forEach(u => {
                        const tr = document.createElement('tr');
                        tr.innerHTML = `<td>${escapeHtml(u.username)}</td><td>${escapeHtml(u.email)}</td><td><a href="#" onclick="openEdit(${u.id})" class="btn btn-sm btn-warning me-2">Edit</a><a href="#" onclick="deleteUser(${u.id})" class="btn btn-sm btn-danger">Delete</a></td>`;
                        tbody.appendChild(tr);
                    });
                });

            window.openEdit = function(id){ window.location = '/User/EditUser/' + id; };
            window.deleteUser = function(id){ if (!confirm('Delete user?')) return; fetch('/api/users/' + id, { method: 'DELETE', credentials: 'include' }).then(()=> location.reload()); };
            window.openRegister = function(){ window.location = '/User/Register'; };

            function escapeHtml(str){ if (!str) return ''; return String(str).replace(/[&<>"]+/g, s => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[s])); }
        })();
    </script>
}
